<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overview</title>
    <link rel="stylesheet" href="/css/components/navbar.css">
    <link rel="stylesheet" href="/css/pages/overview.css">
    <link rel="stylesheet" href="/css/components/footer.css">
    <script src="/javaScript/navbar/navToggle.js" defer></script>
    <script src="/javaScript/navbar/profile-icon-dropdown.js" defer></script>
</head>
<body>
    <%- include('./partials/navbar'); %>

    <section class="product-overview">
        <div class="container">
            <div class="product-content">
                <div class="product-thumbnail"><img src="<%= product.image_url.startsWith('/') ? product.image_url : '/' + product.image_url %>" alt="<%= product.name %>"></div>
                <div class="product-information">
                    <div class="product-title">
                        <h1><%= product.name %></h1>
                    </div>
                    <div class="product-review">
                        5 review
                    </div>
                    <div class="product-price"><%= product.lowest_price %> php</div>
                    <div class="product-description">
                        <p><%= product.description %></p>
                    </div>
                    <div class="product-variant-container">
                        <div class="product-weight-select">
                            <label for="weight">Weight</label>
                            <div class="weight-select" id="weight">100g</div>
                        </div>
                        <div class="product-quantity">
                            <label for="">Quantity</label>
                            <div class="quantity-btn-container">
                                <button class="quantity-btn" aria-label="Decrease quantity">-</button>
                                <input class="quantity-input" type="number" value="1" aria-label="Product quantity">
                                <button class="quantity-btn" aria-label="Increase quantity">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-container">
                        <form action="/cart/add" method="post" class="form">
                            <input type="hidden" name="product_id" value="<%= product.id %>">
                            <input type="hidden" name="weight_id" value="<%=  %>">
                            <% if (locals.user) { %>
                            <input type="hidden" name="user_id" value="<%= userId %>">
                            <% } %>
                            <input type="hidden" name="quantity" id="quantity" value="1">
                            <div class="product-form-btn">
                                <button type="submit">Add to Cart</button>
                                <button type="button">Buy it Now</button>
                            </div>
                        </form>
                    </div>
                    <div class="product-availability">Availability: <%= product.stock %> left in stock</div>
                </div>
            </div>
        </div>
    </section>

    <%- include('./partials/footer'); %>

    <script>

        const productStock = parseInt(`<%= product.stock %>`);
        // Handle quantity increase and decrease
        const increaseBtn = document.querySelector('.quantity-btn-container button:nth-child(3)');
        const decreaseBtn = document.querySelector('.quantity-btn-container button:nth-child(1)');
        let quantityInput = document.querySelector('.quantity-input');
        const quantityField = document.querySelector('#quantity');

        increaseBtn.addEventListener('click', () => {
            let quantity = quantityInput.value;
            if (quantity < productStock) {
                quantity++;
                quantityInput.value = quantity;
                quantityField.value = quantity; // Update the hidden input to reflect the value
            }else{
                console.log('err')
            }
            });

        decreaseBtn.addEventListener('click', () => {
            let quantity = quantityInput.value;
            if (quantity > 1) {
                quantity--;
                quantityInput.value = quantity;
                quantityField.value = quantity; // Update the hidden input to reflect the value
            }
        });
    </script>

</body>
</html>